# Postgrocker Local

## Локальный PostgreSQL с кастомными параметрами через Docker Compose
Этот проект позволяет запустить PostgreSQL с пользовательскими параметрами, которые задаются прямо в `docker-compose.yml` через командную строку.
Все параметры конфигурации теперь явно прописаны и легко изменяются.

### Шаг 1: Клонирование репозитория
Сначала клонируйте репозиторий на ваш локальный компьютер. Откройте терминал и выполните следующую команду:
```bash
git clone https://github.com/SBRDIGITAL/postgrocker_local.git
```

### Шаг 2: Создание файла `.env`
Перейдите в директорию проекта:
```bash
cd postgrocker_local
```

Создайте файл `.env` в корневой директории проекта. Например:
```env
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_PORT=5435
```

### Шаг 3: Запуск базы данных
Убедитесь, что у вас установлен `Docker` и `Docker Compose`. Затем выполните следующую команду в терминале для запуска контейнера:
```bash
docker-compose up -d
```
Флаг `-d` запускает контейнер в фоновом режиме.

**Перед запуском обязательно замените в файле `docker-compose.yml`:**

| Что менять         | Где менять                | Пример                |
|--------------------|--------------------------|-----------------------|
| Название сервиса   | services: <имя_сервиса>  | postgrocker           |
| container_name     | container_name: <имя>    | postgrocker           |
| networks           | networks: <имя_сети>     | postgrocker_network   |

Задайте свои уникальные значения, чтобы избежать конфликтов и сделать конфигурацию более читаемой.

### Кастомные параметры PostgreSQL
Все параметры конфигурации теперь задаются явно в секции `command:` файла `docker-compose.yml`:

| Параметр                      | Значение      | Назначение/Описание |
|-------------------------------|--------------|---------------------|
| shared_buffers                | 1GB          | Размер буфера памяти для страниц БД |
| effective_cache_size          | 4GB          | Оценка доступного кэша ОС для PostgreSQL |
| work_mem                      | 13MB         | Память на одну сортировку/операцию |
| maintenance_work_mem          | 256MB        | Память для операций обслуживания (VACUUM, CREATE INDEX) |
| min_wal_size                  | 2GB          | Минимальный размер WAL сегментов |
| max_wal_size                  | 3GB          | Максимальный размер WAL сегментов |
| checkpoint_completion_target  | 0.9          | Доля времени между чекпоинтами |
| wal_buffers                   | -1           | Размер буфера WAL (автоматически) |
| listen_addresses              | '*'          | На каких адресах слушать подключения |
| max_connections               | 100          | Максимальное число одновременных подключений |
| random_page_cost              | 1.1          | Оценка стоимости случайного чтения страницы |
| effective_io_concurrency      | 200          | Количество одновременных операций ввода-вывода |
| max_worker_processes          | 8            | Максимум воркеров для параллельных задач |
| max_parallel_workers_per_gather | 2         | Воркеры для параллельных запросов |
| max_parallel_workers          | 2            | Общий лимит параллельных воркеров |
| logging_collector             | on           | Включить сбор логов в файлы |
| log_checkpoints               | on           | Логировать чекпоинты |
| log_connections               | on           | Логировать подключения |
| log_disconnections            | on           | Логировать отключения |
| log_lock_waits                | on           | Логировать ожидания блокировок |
| log_temp_files                | 0            | Логировать все временные файлы |
| lc_messages                   | 'C'          | Язык сообщений сервера |
| log_min_duration_statement    | '10s'        | Логировать запросы дольше 10 секунд |
| log_autovacuum_min_duration   | 0            | Логировать все autovacuum |
| log_destination               | 'csvlog'     | Формат логов (CSV для pgbadger) |

Все параметры можно изменить прямо в `docker-compose.yml`.

### Шаг 4: Проверка работы базы данных
После успешного запуска контейнера вы можете подключиться к базе данных `PostgreSQL` с помощью любого клиента, используя следующие параметры подключения:
- **Хост**: `localhost`
- **Порт**: `5435`
- **Имя базы данных**: `postgrocker_db`
- **Пользователь**: `postgrocker_user`
- **Пароль**: `your_password` (замените на ваш пароль)

Пример подключения через psql:
```bash
psql -h localhost -p 5435 -U postgres -d postgres
```

### Шаг 5: Остановка и удаление контейнера
Чтобы остановить контейнер, выполните команду:
```bash
docker-compose down
```
Это остановит контейнеры, созданные `Docker Compose`.

### Заключение
Теперь у вас есть локальная `PostgreSQL`, работающая в контейнере `Docker`.
Вы можете использовать эту базу данных для разработки и тестирования ваших приложений.

**Все параметры сервера теперь легко настраиваются через docker-compose.yml!**